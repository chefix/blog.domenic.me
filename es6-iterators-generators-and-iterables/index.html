
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ES6 Iterators, Generators, and Iterables</title>
  <meta name="author" content="Domenic Denicola">

  
  <meta name="description" content="I wrote up a quick guide to the terminology around ES6&rsquo;s iteration-related concepts, plus some notes and other
resources. Definitions An &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://blog.domenic.me/es6-iterators-generators-and-iterables/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Hidden Variables" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet">




    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:creator" content="@domenic" />
    <meta property="og:title" content="ES6 Iterators, Generators, and Iterables" />
    <meta property="og:description" content="I wrote up a quick guide to the terminology around ES6&rsquo;s iteration-related concepts, plus some notes and other
resources. Definitions An iterator is an object with a next method that returns { done, value } tuples. An iterable is an object &hellip;" />


  
  <script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37626687-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Hidden Variables</a></h1>
  
    <h2>Domenic's blog about coding and stuff</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.domenic.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ES6 Iterators, Generators, and Iterables</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-05T20:00:00-04:00" pubdate data-updated="true">Sep 5<sup>th</sup>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I wrote up a quick guide to the terminology around ES6&rsquo;s iteration-related concepts, plus some notes and other
resources.</p>

<h2 id="definitions">Definitions</h2>

<p>An <strong>iterator</strong> is an object with a <code>next</code> method that returns <code>{ done, value }</code> tuples.</p>

<p>An <strong>iterable</strong> is an object which has an internal method, written in the current ES6 draft specs as
<code>obj[@@iterator]()</code>, that returns an iterator.</p>

<p>A <strong>generator</strong> is a specific type of iterator whose <code>next</code> results are determined by the behavior of its corresponding
generator function. Generators also have a <code>throw</code> method, and their <code>next</code> method takes a parameter.</p>

<p>A <strong>generator function</strong> is a special type of function that acts as a constructor for generators. Generator function
bodies can use the contextual keyword <code>yield</code>, and you can send values or exceptions into the body, at the points where
<code>yield</code> appears, via the constructed generator&rsquo;s <code>next</code> and <code>throw</code> methods. Generator functions are written with
<code>function*</code> syntax.</p>

<p>A <strong>generator comprehension</strong> is a shorthand expression for creating generators, e.g.
<code>(for (x of a) for (y of b) x * y)</code>.</p>

<h2 id="notes">Notes</h2>

<h3 id="for-of"><code>for</code>-<code>of</code></h3>

<p>The new <code>for</code>-<code>of</code> loop works on iterables, i.e. you do <code>for (let x of iterable) { /* ... */ }</code>. So for example, it
works on arrays by looking up their <code>Array.prototype[@@iterator]()</code> internal method, which is specified to return an
iterator that does what you&rsquo;d expect. Similarly <code>Map.prototype</code>, <code>Set.prototype</code>, and others all have <code>@@iterator</code>
methods that help them work with <code>for</code>-<code>of</code> and other constructs in the language that consume iterators.</p>

<p>Note that <code>for</code>-<code>in</code> has nothing to do with iterables, or indeed any of the concepts discussed here. It still works as
it did before, looping through enumerable object properties, and it will be pretty useless when given an iterable of any
sort.</p>

<h3 id="iterable-iterators">Iterable Iterators</h3>

<p>An <em>iterator</em> can also be <em>iterable</em> if it has an <code>@@iterator()</code> internal method. Most iterators in the ES6 draft spec
are also iterable, with the internal method just returning <code>this</code>. In particular, all generators created via generator
functions or generator comprehensions have this behavior. So you can do:</p>

<figure class='code'><figcaption><span></span></figcaption><pre class='highlight'><code class='js'><span class="kr">const</span> <span class="nx">lazySequence</span> <span class="o">=</span> <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">of</span> <span class="nx">a</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="nx">y</span> <span class="nx">of</span> <span class="nx">b</span><span class="p">)</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">z</span> <span class="nx">of</span> <span class="nx">lazySequence</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></figure>

<h3 id="making-iterable-objects">Making Iterable Objects</h3>

<p>To make a custom iterable object, you use the <code>Symbol.iterator</code> symbol, which is the inside-JavaScript way of referring
to the specification&rsquo;s <code>@@iterator</code>. It should return an iterator, thus making your object iterable. The easiest way to
write the iterator-returning method is to use generator syntax. Putting this all together, it looks like</p>

<figure class='code'><figcaption><span></span></figcaption><pre class='highlight'><code class='js'><span class="kr">const</span> <span class="nx">iterable</span> <span class="o">=</span> <span class="p">{</span>
  <span class="o">*</span><span class="p">[</span><span class="nx">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]()</span> <span class="p">{</span>
    <span class="nx">yield</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">yield</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nx">yield</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">x</span> <span class="nx">of</span> <span class="nx">iterable</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></figure>

<h3 id="generator-comprehension-desugaring">Generator Comprehension Desugaring</h3>

<p>You can think of generator comprehensions as &ldquo;sugar&rdquo; for writing out and immediately invoking a generator function, with
<code>yield</code>s inserted implicitly at certain points. For example, the comprehension <code>(for (x of a) for (y of b) x * y)</code>
desugars to</p>

<figure class='code'><figcaption><span></span></figcaption><pre class='highlight'><code class='js'><span class="p">(</span><span class="kd">function</span><span class="o">*</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">of</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">y</span> <span class="nx">of</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">yield</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">y</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}())</span>
</code></pre></figure>

<h3 id="a-weirdness">A Weirdness</h3>

<p>It&rsquo;s not entirely clear why generator comprehensions create generators instead of simple iterable-iterators. In
particular, as you can see from the above desugaring, calling <code>throw</code> or giving a parameter to <code>next</code> is pretty useless:</p>

<figure class='code'><figcaption><span></span></figcaption><pre class='highlight'><code class='js'><span class="kr">const</span> <span class="nx">g</span> <span class="o">=</span> <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nx">x</span> <span class="nx">of</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">);</span>

<span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>                   <span class="c1">// returns { done: false, value: 1 }</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>                  <span class="c1">// returns { done: false, value: 2 }</span>
<span class="nx">g</span><span class="p">.</span><span class="k">throw</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;boo!&quot;</span><span class="p">));</span> <span class="c1">// immediately throws the error</span>
</code></pre></figure>

<p>It seems the arguments in favor of generators instead of iterable-iterators are largely that it makes implementers&#39; jobs
easier, at least according to
<a href="http://esdiscuss.org/topic/why-do-generator-expressions-return-generators">this es-discuss thread</a> I started.</p>

<h2 id="implementation-status">Implementation Status</h2>

<p>Due to the tireless work of <a href="http://wingolog.org/">Andy Wingo</a>, V8 (Chrome) has support for generator functions, behind
the <code>--harmony</code> flag (or &ldquo;Experimental JavaScript Features&rdquo; in chrome://flags). It also has some form of <code>for</code>-<code>of</code>,
which only works with generators and with the custom iterables returned by <code>Array.prototype.values</code> and
<code>Array.prototype.keys</code>, but does not work with anything else (e.g. arrays themselves). I assume this is because the
iteration protocol has not been implemented yet. V8 does not have generator comprehensions.</p>

<p>SpiderMonkey (Firefox) has an old version of everything here, with outdated syntax and semantics. Over the last week or
so, Andy has submitted patches to update their generator implementation. He&rsquo;s now working on <code>for</code>-<code>of</code> and the
iteration protocol in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=907077">bug #907077</a>; no word on generator
comprehensions. Note that SpiderMonkey, unlike V8, does not hide these features behind a default-off flag.</p>

<p>Chakra (Internet Explorer) is as always a complete mystery, with no transparency into their development cycle or even
priority list.</p>

<p>And I still haven&rsquo;t forgiven JavaScriptCore (Safari) for its long period of forgetting to implement
<code>Function.prototype.bind</code>, so I haven&rsquo;t even tried looking into their status.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Domenic Denicola</span></span>

      








  


<time datetime="2013-09-05T20:00:00-04:00" pubdate data-updated="true">Sep 5<sup>th</sup>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/categories/javascript/'>javascript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="https://blog.domenic.me/es6-iterators-generators-and-iterables/" data-via="domenic" data-counturl="https://blog.domenic.me/es6-iterators-generators-and-iterables/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/explaining-away-the-webs-magic/" title="Previous Post: Explaining Away the Web's Magic">&laquo; Explaining Away the Web's Magic</a>
      
      
        <a class="basic-alignment right" href="/the-extensible-web/" title="Next Post: The Extensible Web">The Extensible Web &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/the-revealing-constructor-pattern/">The Revealing Constructor Pattern</a>
      </li>
    
      <li class="post">
        <a href="/continual-progress-in-the-w3c-tag/">Continual Progress in the W3C TAG</a>
      </li>
    
      <li class="post">
        <a href="/the-extensible-web/">The Extensible Web</a>
      </li>
    
      <li class="post">
        <a href="/es6-iterators-generators-and-iterables/">ES6 Iterators, Generators, and Iterables</a>
      </li>
    
      <li class="post">
        <a href="/explaining-away-the-webs-magic/">Explaining Away the Web's Magic</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/domenic">@domenic</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'domenic',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Domenic Denicola -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script>
      var disqus_shortname = 'hiddenvariables';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'https://blog.domenic.me/es6-iterators-generators-and-iterables/';
        var disqus_url = 'https://blog.domenic.me/es6-iterators-generators-and-iterables/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script');
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      document.body.appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.head.appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
